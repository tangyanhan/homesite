<!DOCTYPE html>
<html lang="en-US">
<head>
    {% load static %}
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <script type="text/javascript" src="{% static 'js/jquery-3.1.1.min.js' %}"></script>

    <script>
		$(document).ready( function(){
		    $("#sug-list").hide()
			loadPage()
		});

function loadPage() {
	var keyword = "{{ keyword }}"
	var pageIndex = {{ idx }}
	var pageNum = {{ pageNum }}
	var results = {{ results|safe }}

	$("#search_query_query").value = keyword

	// Deal with title
	title = "视频首页"
	if( keyword.length > 0 ) {
		title = keyword
		if( pageIndex > 0 ) {
			title = title + "#" + pageIndex
		}
	}

	document.title = title

	var videoDiv = $("#videos")
	videoDiv.empty() //remove old results

	if( results.length == 0 ) {
	    if(keyword.length == 0) {
	        videoDiv.innerHTML = "目前没有收录任何视频"
	    }else{
	        videoDiv.innerHTML = "没有找到 <b>" + keyword + "</b> 的相关搜索结果"
	    }
	}

	for(var i=0; i<results.length; i++) {
		video = results[i]

		li = document.createElement("li")
		li.setAttribute("class", "thumb")

		thumbContainer = document.createElement("div")
		thumbContainer.setAttribute("class","thumb-container")
			spanImg = document.createElement("span")
				spanImg.setAttribute("class", "thumb-image")
					a = document.createElement("a")
					a.setAttribute("class","item-link")
					a.href = "/play/" + video.id
						img = document.createElement("img")
						img.src = "{% static 'thumb/' %}" + video.id + ".png"
						img.setAttribute("data-image-error-source","{% static 'images/no-img.png' %}")
					a.append(img)
				spanImg.append(a)
		thumbContainer.append(spanImg)
			lenSpan = document.createElement("span")
			lenSpan.setAttribute("class","length")
			lenSpan.innerHTML = durationStringFromSeconds(video.duration)
			thumbContainer.append(lenSpan)

			titleSpan = document.createElement("span")
			titleSpan.setAttribute("class","title")
				titleLink = document.createElement("a")
				titleLink.setAttribute("class","title-item-link")
				titleLink.href = "/play/" + video.id
				titleLink.innerHTML = video.title

				titleSpan.append(titleLink)
			thumbContainer.append(titleSpan)

		li.append(thumbContainer)

		videoDiv.append(li)
	}

	//recreate page index if necessary
	updatePageIndex(pageIndex, pageNum, keyword, getLocation)

	$("pagination-summary").innerHTML = ""
	if( results.length > 0 ) {
	    if( keyword.length > 0 ) {
	        $("pagination-summary").innerHTML = "Showing " + results.length + " results on page " + (pageIndex + 1) + " of " + pageNum + "using keyword:" + keyword
	    }else{
	        $("pagination-summary").innerHTML = "Showing " + results.length + " results on page " + (pageIndex + 1) + " of " + pageNum
	    }
	}
}
    </script>
    <style>
        #sug-list a{
            font-size: 80%;
        }
        #sug-list a:link{
            color:gray;
        }
        #sug-list a:visited{
            color:purple;
        }

        #videos{
            padding-left:10px;
        }

        li.thumb{
            float:left;
            position:relative;
            margin-left:10px;
            margin-bottom:20px;
            height:auto;
            list-style-type:none;
        }

        .thumb-container{
            width:180px;
            height:155px;
        }

        span.length{
            position:absolute;
            top:0;
            left:0;
            background:black;
            opacity:0.7;
            text-align:left;
        }
        span.thumb-image{
            width:100%;
            height:135px;
        }
        span.title{
            text-align:center;
            position:absolute;
            color:white;
            left:0;
            right:0;
            bottom:0;
            height:20px;
        }
    </style>
</head>

<header>

</header>

<body>

{% include 'nav.html' %}

<ul class="row mycontainer" id="videos">
</ul>

<nav class="mycontainer" aria-label="Page navigation">
  <ul id="pages" class="pagination">
  </ul>
</nav>


</body>
</html>