<header>
  {% load static %}
    <script type="text/javascript" src="{% static 'js/jquery-3.1.1.min.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/search-bar.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/pageidx.js' %}"></script>
    <link href="{% static 'bootstrap-3.3.7/css/bootstrap.css' %}" rel="stylesheet">
    <script>
		$(document).ready( function(){
		    $("#sug-list").hide()

			$("#search_button").click(function(){
			  search( $("#keyword_input").val() )
			})

            $("#keyword_input").focus(function(){
                showSuggestion()
            })

			$("#keyword_input").keyup(function(event){
				showSuggestion()
			})

			$("#keyword_input").focus(function(){
			    showSuggestion()
			})

			$(document).click(function(e){
			 e = window.event || e; // 兼容IE7
			 obj = $(e.srcElement || e.target);
			    if ($(obj).is("#sug-list,#sug-list *,#keyword_input")) {
			   } else {
			   	$("#sug-list").hide()
			 }
			});

			$('#keyword_input').bind('keypress',function(event){
	            if(event.keyCode == "13")
    	        {
        	        search($(this).val())
            	}
        	})
		});

function showSuggestionList(keywords) {
    if(keywords.length == 0) return

    var ul = $("#sug-list")
    ul.empty()
    for (var i = keywords.length - 1; i >= 0; i--) {
        li = document.createElement("li")
            a = document.createElement("a")
            a.href = getLocation(keywords[i],0)
            a.innerHTML = keywords[i]
            li.append(a)
        ul.append(li)
    }
    $("#sug-list").show()
}

function showSuggestion() {
    var keyword = document.getElementById("keyword_input").value

    keyword = processKeyword(keyword)

    if(keyword.length == 0) {
        var historyKeywords = getCookie("history-keywords")
        if(historyKeywords.length > 0){
            keywords = historyKeywords.split("##")

            showSuggestionList(keywords)
        }
    }else{
		$.post("{% url 'keyword_suggest' %}", { 'keyword':keyword, 'csrfmiddlewaretoken': getCookie('csrftoken')},
			function(data,status){
			if(status == "success"){
				var keywords = JSON.parse(data)
				showSuggestionList(keywords)
			}
		})
    }

}

function search(keyword) {

    if(typeof keyword == "undefined" || keyword==null){
        keyword = $("#keyword_input").val()
    }

	keyword = processKeyword(keyword)

    if(keyword.length == 0 || keyword == " ") return false

    //Add it to cookie if it does not exist
    addHistoryKeyword(keyword)

    $("#keyword_input").blur()
    $("#sug-list").hide()

	window.location.href = getLocation(keyword, 0)
}

function processKeyword(keyword){
	keyword = keyword.toLowerCase()
    keyword = keyword.replace(/\s+/, ' ')
    keyword = keyword.replace(/&/,'')

    return keyword
}

function getLocation(keyword, pageIndex) {
	return "{% url 'search' %}" + "?&keyword=" + keyword + "&idx=" + pageIndex
}

function durationStringFromSeconds(seconds) {
	var duration = ""

	var sec = seconds % 60
	var min = parseInt(seconds / 60)
	var hour = 0
	if (min >= 60) {
		hour = parseInt(min / 60)
		min %= 60

		duration += hour
	 }

	duration = duration + ((hour>0)? ":" : "") +((min<10)? "0" : "") + min + ":" + ((sec<10)? "0" :"") + sec

	return duration
}

    </script>
    <style>
        @media (max-width:767px){
            .mycontainer{
                width:100%;
            }
        }
        @media (min-width:768px){
            .mycontainer{
                margin-left:30px;
                margin-right:30px;
            }
        }
        .mycontainer{
            margin-top:20px;
        }
    </style>
<!-- navbar -->
  <nav class="navbar nav-default" style="">
  <div class="mycontainer">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed btn btn-default" data-toggle="collapse" data-target="#navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="glyphicon glyphicon-menu-hamburger" style="color:#337ab7;"></span>
      </button>

      <div class="input-group" style="margin-top:15px;max-width:400px;">
        <span class="input-group-addon" id="search_button">
          <span class="glyphicon glyphicon-search"></span>
        </span>
        <input id="keyword_input" class="form-control" type="search" placeholder="Search Keywords">
        <ul id="sug-list" style="z-index:5; width:100%;position:absolute;color:000;top:36px;background-color: #fff;list-style-type: none;padding: 0;padding-left: 5px;margin: 0;border: 1px solid #ccc;border-top: none;display: block;">
        </ul>
      </div>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
          <li><a class="btn-primary" href="/">Home</a></li>
          <li class="active"><a href="{% url 'video-index' %}">Videos<span class="sr-only">(current)</span></a></li>
          <li><a href="{% url 'live-index' %}">Live</a></li>
          {% if request.user.is_authenticated %}
          <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">{{ request.user.username }} <span class="caret"></span></a>
            <ul class="dropdown-menu">
                <li><a href="#">Info</a></li>
                <li><a href="#">Settings</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="{% url 'admin:logout' %}">Log out</a></li>
            </ul>
            </li>
          {% else %}
            <li><a href="{% url 'admin:login' %}?next={{ request.path }}">Log in</a></li>
            <li><a href="{% url 'admin:logout' %}?next=/">Sign up</a></li>
          {% endif %}
      </ul>
    </div><!-- /.navbar-collapse -->

  </div><!-- /.container-fluid -->
</nav>

</header>
